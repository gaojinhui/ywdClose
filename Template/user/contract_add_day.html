<!DOCTYPE html>
<html>
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
	<title>我的账户</title>
	<link rel="stylesheet" href="/public/home/css/user.css" />
	<link href="__USER__/css/home.css" rel="stylesheet" type="text/css" />
	<link href="__USER__/css/usercommon.css" rel="stylesheet" type="text/css" />
	<link rel="stylesheet" href="__LAY__/css/layui.css" media="all" />
	<script type="text/javascript" charset="utf-8" src="__UE__ueditor.config.js"></script>
	<script type="text/javascript" charset="utf-8" src="__UE__ueditor.all.min.js"> </script>
	<script type="text/javascript" charset="utf-8" src="__UE__lang/zh-cn/zh-cn.js"></script>
	<style>
		body{ margin: 10px;}
	</style>
</head>
<body>
<fieldset class="layui-elem-field layui-field-title" style="margin-top: 20px;">
	<legend style="margin:auto; font-weight: bold">日常买卖合同</legend>
</fieldset>

<form class="layui-form layui-form-pane" action="javascript:">


	<div class="layui-form-item">
		<div class="layui-inline">
			<label class="layui-form-label" style="width: 120px">出卖人(销方)</label>
			<div class="layui-input-inline">
				<input type="tel" name="seller" lay-verify="required" autocomplete="off" class="layui-input">
			</div>
		</div>
		<div class="layui-inline">
			<label class="layui-form-label" style="width: 120px">企业合同编号</label>
			<div class="layui-input-inline">
				<input type="text" name="contract_number" lay-verify="required" autocomplete="off" class="layui-input">
			</div>
		</div>
		<div class="layui-inline">
			<label class="layui-form-label" style="width: 120px">装车地</label>
			<div class="layui-input-inline">
				<input type="text" name="loading_place" lay-verify="required" autocomplete="off" class="layui-input">
			</div>
		</div>
	</div>
	<div class="layui-form-item">
	<div class="layui-inline">
		<label class="layui-form-label" style="width: 120px">买受人(购方)</label>
		<div class="layui-input-inline">
			<input type="tel" name="buyer" lay-verify="required" autocomplete="off" class="layui-input">
		</div>
	</div>
	<div class="layui-inline">
		<label class="layui-form-label" style="width: 120px">运输方式</label>
		<div class="layui-input-inline">
			<select name="transport" lay-verify="required" lay-search="">
				<option value="">直接选择或搜索选择</option>
				{volist name="trans_type" id="vo"}
				<option value="{$vo.id}">{$vo.trans_text}</option>
				{/volist}
			</select>
		</div>
	</div>
	<div class="layui-inline">
		<label class="layui-form-label" style="width: 120px">卸车地</label>
		<div class="layui-input-inline">
			<input type="text" name="unloaded" lay-verify="required" autocomplete="off" class="layui-input">
		</div>
	</div>
</div>
	<div class="layui-form-item">
		<div class="layui-inline">
			<label class="layui-form-label" style="width: 120px">交易方式</label>
			<div class="layui-input-inline">
				<select name="delivery_type" lay-verify="required" lay-search="">
					<option value="">直接选择或搜索选择</option>
					{volist name="traded_type" id="vo"}
					<option value="{$vo.id}">{$vo.trade_text}</option>
					{/volist}
				</select>
			</div>
		</div>
		<div class="layui-inline">
			<label class="layui-form-label" style="width: 120px">价格类型</label>
			<div class="layui-input-inline">
				<select name="price_type" lay-verify="required" lay-search="">
					<option value="">直接选择或搜索选择</option>
					{volist name="price_type" id="vo"}
					<option value="{$vo.id}">{$vo.price_text}</option>
					{/volist}
				</select>
			</div>
		</div>
		<div class="layui-inline">
			<label class="layui-form-label" style="width: 120px">签订时间</label>
			<div class="layui-input-inline">
				<input type="text" name="sign_date" lay-verify="required" id="gettime" autocomplete="off" class="layui-input">
			</div>
		</div>
	</div>
	<div class="layui-form-item">
		<div class="layui-inline">
			<label class="layui-form-label" style="width: 120px">发货单位</label>
			<div class="layui-input-inline">
				<input type="tel" name="consignor" lay-verify="required" autocomplete="off" class="layui-input">
			</div>
		</div>

	</div>
	<blockquote class="layui-elem-quote layui-text" style="border-left:0">
		一、收货人名称、品种规格、数量、单价
	</blockquote>
	<div class="layui-form-item">
		<div class="layui-inline">
			<label class="layui-form-label">收货人名称</label>
			<div class="layui-input-inline">
				<input type="tel" name="consignee" lay-verify="required" autocomplete="off" class="layui-input">
			</div>
		</div>
		<div class="layui-inline">
			<label class="layui-form-label" style="width: 110px">商品名称</label>
			<div class="layui-input-inline">
				<input type="text" name="goods_name" lay-verify="required" autocomplete="off" class="layui-input">
			</div>
		</div>
		<div class="layui-inline">
			<label class="layui-form-label">价格</label>
			<div class="layui-input-inline" style="width: 110px">
				<select name="price" lay-verify="required" lay-search="">
					<option value="">直接选择或搜索选择</option>
					{volist name="unit_price" id="vo"}
					<option value="{$vo.id}">{$vo.unit_type}</option>
					{/volist}
				</select>
			</div>
			<div class="layui-input-inline">
				<input type="text" name="price" lay-verify="required" autocomplete="off" class="layui-input">
			</div>
		</div>

	</div>
	<div class="layui-form-item">
		<div class="layui-block">
			<label class="layui-form-label">质量指标</label>
			<div class="layui-input-inline">
				<select name="quality_index" lay-verify="required" lay-search="">
					<option value="">直接选择或搜索选择</option>
					{volist name="quality_type" id="vo"}
					<option value="{$vo.id}">{$vo.quality_text}</option>
					{/volist}
				</select>
			</div>
		</div>
	</div>
	<div class="layui-form-item layui-form-text">

		<div class="layui-input-block">
			<textarea placeholder="请输入内容" name="quality_info" class="layui-textarea"></textarea>
		</div>
	</div>
	<blockquote class="layui-elem-quote layui-text" style="border-left:0">
		一、交(提)货时间，物品数量（吨）
	</blockquote>
	<div class="layui-form-item">
		<label class="layui-form-label">数量（吨）</label>
		<div class="layui-input-block">
			<input type="text" name="quantity" lay-verify="required" placeholder="" autocomplete="off" class="layui-input">
		</div>
	</div>
	<div class="layui-form-item">
		<label class="layui-form-label">条款模板</label>
		<div class="layui-input-inline" style="width: 200px">
			<select name="template" lay-verify="required" lay-search="" style="z-index: 999999">
				<option value="">直接选择或搜索选择</option>
				{volist name="user_tpl" id="vo"}
				<option value="{$vo.id}">{$vo.title}</option>
				{/volist}
			</select>
		</div>
		<button class="layui-btn layui-bg-red savetpl" lay-submit=""  lay-filter="tplsave">模板另存</button>
	</div>
	<div class="layui-form-item">
		<script id="editor" type="text/plain" name="content"  class="uesize"></script>
	</div>
	<fieldset class="layui-elem-field layui-field-title" style="margin-top: 20px;">
		<legend style="font-weight: bold; font-size: 14px;">出卖人</legend>
	</fieldset>
	<div class="layui-row">
		<div class="layui-col-xs6">
			<div class="layui-form-item">
				<label class="layui-form-label" style="width: 180px;">出卖人名称(章)</label>
				<div class="layui-input-inline">
					<input type="text" name="seller_name" lay-verify="required" placeholder="请输入" autocomplete="off" class="layui-input">
				</div>

			</div>
			<div class="layui-form-item">
				<label class="layui-form-label" style="width: 110px;">住所</label>
				<div class="layui-input-inline">
					<input type="text" name="seller_address" lay-verify="required" placeholder="请输入" autocomplete="off" class="layui-input">
				</div>

			</div>
			<div class="layui-form-item">
				<label class="layui-form-label" style="width: 110px;">法定代表人</label>
				<div class="layui-input-inline">
					<input type="text" name="seller_egal" lay-verify="required" placeholder="请输入" autocomplete="off" class="layui-input">
				</div>

			</div>
			<div class="layui-form-item">
				<label class="layui-form-label" style="width: 110px;">委托代理人</label>
				<div class="layui-input-inline">
					<input type="text" name="seller_agent" lay-verify="required" placeholder="请输入" autocomplete="off" class="layui-input">
				</div>

			</div>
			<div class="layui-form-item">
				<label class="layui-form-label" style="width: 110px;">电话</label>
				<div class="layui-input-inline">
					<input type="text" name="seller_phone" lay-verify="required" placeholder="请输入" autocomplete="off" class="layui-input">
				</div>

			</div>
			<div class="layui-form-item">
				<label class="layui-form-label" style="width: 110px;">传真</label>
				<div class="layui-input-inline">
					<input type="text" name="seller_fax" lay-verify="" placeholder="请输入" autocomplete="off" class="layui-input">
				</div>

			</div>
			<div class="layui-form-item">
				<label class="layui-form-label" style="width: 110px;">邮政编码</label>
				<div class="layui-input-inline">
					<input type="text" name="seller_postcode" lay-verify="required" placeholder="请输入" autocomplete="off" class="layui-input">
				</div>

			</div>
			<div class="layui-form-item">
				<label class="layui-form-label" style="width: 110px;">开户银行</label>
				<div class="layui-input-inline">
					<input type="text" name="seller_bank_deposit" lay-verify="required" placeholder="请输入" autocomplete="off" class="layui-input">
				</div>

			</div>
			<div class="layui-form-item">
				<label class="layui-form-label" style="width: 110px;">账号</label>
				<div class="layui-input-inline">
					<input type="text" name="seller_bank_number" lay-verify="required" placeholder="请输入" autocomplete="off" class="layui-input">
				</div>

			</div>
			<div class="layui-form-item">
				<label class="layui-form-label" style="width: 110px;">纳税登记号</label>
				<div class="layui-input-inline">
					<input type="text" name="seller_tax_number" lay-verify="required" placeholder="请输入" autocomplete="off" class="layui-input">
				</div>

			</div>
		</div>

		<div class="layui-col-xs6">
			<div class="layui-form-item">
				<label class="layui-form-label" style="width: 200px;">出卖人结算单位名称(章)</label>
				<div class="layui-input-inline">
					<input type="text" name="seller_compay" lay-verify="required" placeholder="请输入" autocomplete="off" class="layui-input">
				</div>

			</div>
			<div class="layui-form-item">
				<label class="layui-form-label" style="width: 110px;">住所</label>
				<div class="layui-input-inline">
					<input type="text" name="seller_address1" lay-verify="required" placeholder="请输入" autocomplete="off" class="layui-input">
				</div>

			</div>
			<div class="layui-form-item">
				<label class="layui-form-label" style="width: 110px;">法定代表人</label>
				<div class="layui-input-inline">
					<input type="text" name="seller_egal1" lay-verify="required" placeholder="请输入" autocomplete="off" class="layui-input">
				</div>

			</div>
			<div class="layui-form-item">
				<label class="layui-form-label" style="width: 110px;">委托搭理人</label>
				<div class="layui-input-inline">
					<input type="text" name="seller_agent1" lay-verify="required" placeholder="请输入" autocomplete="off" class="layui-input">
				</div>

			</div>
			<div class="layui-form-item">
				<label class="layui-form-label" style="width: 110px;">电话</label>
				<div class="layui-input-inline">
					<input type="text" name="seller_phone1" lay-verify="required" placeholder="请输入" autocomplete="off" class="layui-input">
				</div>

			</div>
			<div class="layui-form-item">
				<label class="layui-form-label" style="width: 110px;">传真</label>
				<div class="layui-input-inline">
					<input type="text" name="seller_fax1" lay-verify="" placeholder="请输入" autocomplete="off" class="layui-input">
				</div>

			</div>
			<div class="layui-form-item">
				<label class="layui-form-label" style="width: 110px;">邮政编码</label>
				<div class="layui-input-inline">
					<input type="text" name="seller_postcode1" lay-verify="required" placeholder="请输入" autocomplete="off" class="layui-input">
				</div>

			</div>
			<div class="layui-form-item">
				<label class="layui-form-label" style="width: 110px;">开户银行</label>
				<div class="layui-input-inline">
					<input type="text" name="seller_bank_deposit1" lay-verify="required" placeholder="请输入" autocomplete="off" class="layui-input">
				</div>

			</div>
			<div class="layui-form-item">
				<label class="layui-form-label" style="width: 110px;">账号</label>
				<div class="layui-input-inline">
					<input type="text" name="seller_bank_number1" lay-verify="required" placeholder="请输入" autocomplete="off" class="layui-input">
				</div>

			</div>
			<div class="layui-form-item">
				<label class="layui-form-label" style="width: 110px;">纳税登记号</label>
				<div class="layui-input-inline">
					<input type="text" name="seller_tax_number1" lay-verify="required" placeholder="请输入" autocomplete="off" class="layui-input">
				</div>

			</div>
		</div>
	</div>
	<fieldset class="layui-elem-field layui-field-title" style="margin-top: 20px;">
		<legend style="font-weight: bold; font-size: 14px;">买受人</legend>
	</fieldset>
	<div class="layui-row">
		<div class="layui-col-xs6">
			<div class="layui-form-item">
				<label class="layui-form-label" style="width: 180px;">买受人名称(章)</label>
				<div class="layui-input-inline">
					<input type="text" name="buyer_name" lay-verify="required" placeholder="请输入" autocomplete="off" class="layui-input">
				</div>

			</div>
			<div class="layui-form-item">
				<label class="layui-form-label" style="width: 110px;">住所</label>
				<div class="layui-input-inline">
					<input type="text" name="buyer_address" lay-verify="required" placeholder="请输入" autocomplete="off" class="layui-input">
				</div>

			</div>
			<div class="layui-form-item">
				<label class="layui-form-label" style="width: 110px;">法定代表人</label>
				<div class="layui-input-inline">
					<input type="text" name="buyer_egal" lay-verify="required" placeholder="请输入" autocomplete="off" class="layui-input">
				</div>

			</div>
			<div class="layui-form-item">
				<label class="layui-form-label" style="width: 110px;">委托代理人</label>
				<div class="layui-input-inline">
					<input type="text" name="buyer_agent" lay-verify="required" placeholder="请输入" autocomplete="off" class="layui-input">
				</div>

			</div>
			<div class="layui-form-item">
				<label class="layui-form-label" style="width: 110px;">电话</label>
				<div class="layui-input-inline">
					<input type="text" name="buyer_phone" lay-verify="required" placeholder="请输入" autocomplete="off" class="layui-input">
				</div>

			</div>
			<div class="layui-form-item">
				<label class="layui-form-label" style="width: 110px;">传真</label>
				<div class="layui-input-inline">
					<input type="text" name="buyer_fax" lay-verify="" placeholder="请输入" autocomplete="off" class="layui-input">
				</div>

			</div>
			<div class="layui-form-item">
				<label class="layui-form-label" style="width: 110px;">邮政编码</label>
				<div class="layui-input-inline">
					<input type="text" name="buyer_postcode" lay-verify="required" placeholder="请输入" autocomplete="off" class="layui-input">
				</div>

			</div>
			<div class="layui-form-item">
				<label class="layui-form-label" style="width: 110px;">开户银行</label>
				<div class="layui-input-inline">
					<input type="text" name="buyer_bank_deposit" lay-verify="required" placeholder="请输入" autocomplete="off" class="layui-input">
				</div>

			</div>
			<div class="layui-form-item">
				<label class="layui-form-label" style="width: 110px;">账号</label>
				<div class="layui-input-inline">
					<input type="text" name="buyer_bank_number" lay-verify="required" placeholder="请输入" autocomplete="off" class="layui-input">
				</div>

			</div>
			<div class="layui-form-item">
				<label class="layui-form-label" style="width: 110px;">纳税登记号</label>
				<div class="layui-input-inline">
					<input type="text" name="buyer_tax_number" lay-verify="required" placeholder="请输入" autocomplete="off" class="layui-input">
				</div>

			</div>
		</div>

		<div class="layui-col-xs6">
			<div class="layui-form-item">
				<label class="layui-form-label" style="width: 200px;">买受人结算单位名称(章)</label>
				<div class="layui-input-inline">
					<input type="text" name="buyer_compay" lay-verify="required" placeholder="请输入" autocomplete="off" class="layui-input">
				</div>

			</div>
			<div class="layui-form-item">
				<label class="layui-form-label" style="width: 110px;">住所</label>
				<div class="layui-input-inline">
					<input type="text" name="buyer_address1" lay-verify="required" placeholder="请输入" autocomplete="off" class="layui-input">
				</div>

			</div>
			<div class="layui-form-item">
				<label class="layui-form-label" style="width: 110px;">法定代表人</label>
				<div class="layui-input-inline">
					<input type="text" name="buyer_egal1" lay-verify="required" placeholder="请输入" autocomplete="off" class="layui-input">
				</div>

			</div>
			<div class="layui-form-item">
				<label class="layui-form-label" style="width: 110px;">委托代理人</label>
				<div class="layui-input-inline">
					<input type="text" name="buyer_agent1" lay-verify="required" placeholder="请输入" autocomplete="off" class="layui-input">
				</div>

			</div>
			<div class="layui-form-item">
				<label class="layui-form-label" style="width: 110px;">电话</label>
				<div class="layui-input-inline">
					<input type="text" name="buyer_phone1" lay-verify="required" placeholder="请输入" autocomplete="off" class="layui-input">
				</div>

			</div>
			<div class="layui-form-item">
				<label class="layui-form-label" style="width: 110px;">传真</label>
				<div class="layui-input-inline">
					<input type="text" name="buyer_fax1" lay-verify="" placeholder="请输入" autocomplete="off" class="layui-input">
				</div>

			</div>
			<div class="layui-form-item">
				<label class="layui-form-label" style="width: 110px;">邮政编码</label>
				<div class="layui-input-inline">
					<input type="text" name="buyer_postcode1" lay-verify="required" placeholder="请输入" autocomplete="off" class="layui-input">
				</div>

			</div>
			<div class="layui-form-item">
				<label class="layui-form-label" style="width: 110px;">开户银行</label>
				<div class="layui-input-inline">
					<input type="text" name="buyer_bank_deposit1" lay-verify="required" placeholder="请输入" autocomplete="off" class="layui-input">
				</div>

			</div>
			<div class="layui-form-item">
				<label class="layui-form-label" style="width: 110px;">账号</label>
				<div class="layui-input-inline">
					<input type="text" name="buyer_bank_number1" lay-verify="required" placeholder="请输入" autocomplete="off" class="layui-input">
				</div>

			</div>
			<div class="layui-form-item">
				<label class="layui-form-label" style="width: 110px;">纳税登记号</label>
				<div class="layui-input-inline">
					<input type="text" name="buyer_tax_number1" lay-verify="required" placeholder="请输入" autocomplete="off" class="layui-input">
				</div>

			</div>
		</div>
	</div>
	<hr class="layui-bg-gray">
	<div class="layui-inline" style="margin-left: 49.5% ">
		<label class="layui-form-label">合同有效期</label>
		<div class="layui-input-inline" style="width: 110px;">
			<input type="text" class="layui-input" placeholder="开始时间" id="starttime" placeholder="yyyy-MM-dd">
		</div>
		至
		<div class="layui-input-inline" style="width: 110px;">
			<input type="text" class="layui-input" placeholder="结束时间" id="endtime" placeholder="yyyy-MM-dd">
		</div>
	</div>


	<div class="layui-form-item" style="margin-top: 20px;">
		<div class="layui-input-block">
			<button class="layui-btn" lay-submit="" lay-filter="save">保存</button>
			<button class="layui-btn" lay-submit="" lay-filter="report">保存并提报</button>
		</div>
	</div>
</form>
<script src="__LAY__/layui.js" charset="utf-8"></script>
<script>
    layui.use(['form', 'layedit', 'laydate','table','jquery'], function(){
        var form = layui.form
            ,layer = layui.layer
            ,layedit = layui.layedit
            ,laydate = layui.laydate,
			table = layui.table;
        	$ = layui.jquery;
        laydate.render({
            elem: '#starttime'
        });
        laydate.render({
            elem: '#gettime'
        });
        laydate.render({
            elem: '#endtime'
        });
        //监听提交
        var ue = UE.getEditor('editor');
        ue.ready(function() {
            ue.setHeight(400);
            $(".savetpl").click(function(){
				if(!ue.getContent()){
                    layer.msg("您尚未输入任何内容", {time: 1500, icon:5,shade: 0.4});
				}else{
                    layer.prompt({title: '请输入模板保存的标题', formType: 2}, function(text, index){
                        var loading =  layer.msg("提交中，请稍后.....", {time: false, icon:0,shade: 0.4});
                        $.post("/user/index/save_template",{title:text,content:ue.getContent()},function(data){
                            layer.close(loading);
                            if(data.error_code==0){
                                layer.msg(data.msg, {time: 1500, icon:1,shade: 0.4});
                                layer.close(index);
                            }else{
                                layer.msg(data.msg, {time: 1500, icon:2,shade: 0.4});
                            }
                        });

                    });
				}
                return false;
            })
            form.on('select', function(data){
				if(!data.value){layer.msg("请选择正确内容.....", {time: 1500, icon:2,shade: 0.4}); return false}
                if(data.elem.name=="template"){
                    var loading =  layer.msg("提交中，请稍后.....", {time: false, icon:0,shade: 0.4});
                    $.post("/user/index/get_template",{id:data.value},function(rs){
                        layer.close(loading);
                        if(rs.error_code==0){
                            layer.msg(rs.msg, {time: 1000, icon:1,shade: 0.4},function(){
                                //console.log(rs)
                                ue.setContent(rs.data.tpl_text);
							});
                            layer.close(loading);
                        }else{
                            layer.msg(rs.msg, {time: 1500, icon:2,shade: 0.4});
                        }
                    });

				}

			})
            //设置编辑器的内容
            // ue.setContent('hello');
            // //获取html内容，返回: <p>hello</p>
            // var html = ue.getContent();
            // //获取纯文本内容，返回: hello
            // var txt = ue.getContentTxt();
        });
        laydate.render({
            elem: '#test15'
            ,type: 'datetime'
            ,range: '~'
            ,format:'yyyy/M/d'
        });




        form.on('submit(save)', function(data){
			data.field.status=1;
            var loading =  layer.msg("提交中，请稍后.....", {time: false, icon:0,shade: 0.4});
            $.post("/user/index/add_contract",data.field,function(data){
                layer.close(loading);
                if(data.error_code==0){
                    layer.msg(data.msg, {time: 1500, icon:1,shade: 0.4},function () {
                        var index = parent.layer.getFrameIndex(window.name);
                        parent.layer.close(index);
                        // window.location.reload();
                        window.parent.location.reload();
                    });
                }else{
                    layer.msg(data.msg, {time: 1500, icon:2,shade: 0.4});
                }
            });
            return false;
        });
        form.on('submit(report)', function(data){
            	var loading =  layer.msg("提交中，请稍后.....", {time: false, icon:0,shade: 0.4});
            data.field.status=2;
            $.post("/user/index/add_contract",data.field,function(data){
                layer.close(loading);
				if(data.error_code==0){
                    layer.msg(data.msg, {time: 1500, icon:1,shade: 0.4},function () {
                        var index = parent.layer.getFrameIndex(window.name);
                        parent.layer.close(index);
                      // window.location.reload();
						window.parent.location.reload();
                    });
				}else{
                    layer.msg(data.msg, {time: 1500, icon:2,shade: 0.4});
				}
			});

            return false;
        });
    })
</script>
</body>
</html>